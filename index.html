<!DOCTYPE html>
<html>
<head>
  <title>USGS Flow Data</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      text-align: center;
      padding: 20px;
      font-weight: bold;
    }
    .flow-data {
      font-size: 1.4em;
      line-height: 2;
      white-space: pre;
    }
    canvas {
      max-width: 100%;
      height: 300px !important;
    }
    @media (max-width: 600px) {
      .flow-data {
        font-size: 1.8em;
      }
    }
  </style>
</head>
<body>
  <h2>USGS Flow Data</h2>
  <div class="flow-data" id="flowData"></div>
  <br><br>
  <canvas id="flowChart"></canvas>

  <script>
    const siteIDs = {
      '12389000': 'Clark Fork @ Plains     ',
      '12389500': 'Thompson River          ',
      '12390700': 'Prospect Creek          ',
      '12392155': 'Lightning Creek         ',
      '12395000': 'Priest River            '
    };

    async function fetchFlow(site) {
      const res = await fetch(`https://waterservices.usgs.gov/nwis/iv/?sites=${site}&parameterCd=00060&siteStatus=all&format=json`);
      const json = await res.json();
      const values = json.value.timeSeries[0]?.values[0]?.value || [];
      const last = values[values.length - 1];
      return last ? parseFloat(last.value) : 0;
    }

    async function fetchChartData(site) {
      const res = await fetch(`https://waterservices.usgs.gov/nwis/iv/?sites=${site}&parameterCd=00060&siteStatus=all&format=json`);
      const json = await res.json();
      const values = json.value.timeSeries[0]?.values[0]?.value || [];
      return values.map(v => ({ x: new Date(v.dateTime), y: parseFloat(v.value) }));
    }

    async function updateFlowData() {
      const flowData = document.getElementById('flowData');
      let text = '\n\n';
      let totalFlow = 0;
      let priestFlow = 0;

      for (const [site, name] of Object.entries(siteIDs)) {
        const flow = await fetchFlow(site);
        if (site === '12395000') priestFlow = flow;
        totalFlow += flow;
        text += `${name}: ${flow.toLocaleString(undefined, { maximumFractionDigits: 0 })} cfs\n`;
      }

      // Pack River calculation
      const packFlow = Math.round(1.15 * priestFlow - 45);
      totalFlo
